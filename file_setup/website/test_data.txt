-- ลบข้อมูลในตารางลูกก่อน
DELETE FROM attendance;

-- ลบข้อมูลในตารางหลักและรีเซต id
DELETE FROM students;
ALTER TABLE students AUTO_INCREMENT = 1;

----------------------------------------------------
-- ข้อมูลนักเรียนตัวอย่าง
INSERT INTO students (student_name, student_nickname, parent_name, parent_car_plate, parent_phone, status) VALUES
('กิตติพงษ์ ศรีสุข', 'กิต', 'นายสมชาย ศรีสุข', 'กท 1234', '081-234-5678', 1),
('นฤมล วงศ์ใหญ่', 'นิ้ง', 'นางสาวมาลี วงศ์ใหญ่', 'กท 5678', '082-345-6789', 1),
('ศิริพร แสงทอง', 'พิม', 'นายวิชัย แสงทอง', 'กท 9012', '083-456-7890', 1),
('ธนกร มั่นคง', 'ต้น', 'นางวิภา มั่นคง', 'กท 3456', '084-567-8901', 1),
('อรทัย บุญมา', 'อ้อย', 'นายประเสริฐ บุญมา', 'กท 7890', '085-678-9012', 1),
('พิชญ์นรี สุขใส', 'พิช', 'นางสมหวัง สุขใส', 'กท 2345', '086-789-0123', 1),
('นันทวัฒน์ รุ่งเรือง', 'นนท์', 'นายอนุชา รุ่งเรือง', 'กท 6789', '087-890-1234', 1),
('ปิยะดา เจริญสุข', 'ป้อม', 'นางรัตนา เจริญสุข', 'กท 0123', '088-901-2345', 1);

-- ข้อมูลการเข้าเรียน 8 วัน (17-24 มิถุนายน 2025)
INSERT INTO attendance (student_id, date, status) VALUES
-- วันที่ 17 มิถุนายน 2025
(1, '2025-06-17', 1),  -- กิตติพงษ์ มา
(2, '2025-06-17', 1),  -- นฤมล มา
(3, '2025-06-17', 0),  -- ศิริพร ไม่มา
(4, '2025-06-17', 1),  -- ธนกร มา
(5, '2025-06-17', 1),  -- อรทัย มา
(6, '2025-06-17', 1),  -- พิชญ์นรี มา
(7, '2025-06-17', 0),  -- นันทวัฒน์ ไม่มา
(8, '2025-06-17', 1),  -- ปิยะดา มา

-- วันที่ 18 มิถุนายน 2025
(1, '2025-06-18', 0),  -- กิตติพงษ์ ไม่มา
(2, '2025-06-18', 1),  -- นฤมล มา
(3, '2025-06-18', 1),  -- ศิริพร มา
(4, '2025-06-18', 1),  -- ธนกร มา
(5, '2025-06-18', 0),  -- อรทัย ไม่มา
(6, '2025-06-18', 1),  -- พิชญ์นรี มา
(7, '2025-06-18', 1),  -- นันทวัฒน์ มา
(8, '2025-06-18', 1),  -- ปิยะดา มา

-- วันที่ 19 มิถุนายน 2025
(1, '2025-06-19', 1),  -- กิตติพงษ์ มา
(2, '2025-06-19', 1),  -- นฤมล มา
(3, '2025-06-19', 1),  -- ศิริพร มา
(4, '2025-06-19', 0),  -- ธนกร ไม่มา
(5, '2025-06-19', 1),  -- อรทัย มา
(6, '2025-06-19', 1),  -- พิชญ์นรี มา
(7, '2025-06-19', 1),  -- นันทวัฒน์ มา
(8, '2025-06-19', 0),  -- ปิยะดา ไม่มา

-- วันที่ 20 มิถุนายน 2025
(1, '2025-06-20', 1),  -- กิตติพงษ์ มา
(2, '2025-06-20', 0),  -- นฤมล ไม่มา
(3, '2025-06-20', 1),  -- ศิริพร มา
(4, '2025-06-20', 1),  -- ธนกร มา
(5, '2025-06-20', 1),  -- อรทัย มา
(6, '2025-06-20', 0),  -- พิชญ์นรี ไม่มา
(7, '2025-06-20', 1),  -- นันทวัฒน์ มา
(8, '2025-06-20', 1),  -- ปิยะดา มา

-- วันที่ 21 มิถุนายน 2025
(1, '2025-06-21', 1),  -- กิตติพงษ์ มา
(2, '2025-06-21', 1),  -- นฤมล มา
(3, '2025-06-21', 0),  -- ศิริพร ไม่มา
(4, '2025-06-21', 1),  -- ธนกร มา
(5, '2025-06-21', 1),  -- อรทัย มา
(6, '2025-06-21', 1),  -- พิชญ์นรี มา
(7, '2025-06-21', 0),  -- นันทวัฒน์ ไม่มา
(8, '2025-06-21', 1),  -- ปิยะดา มา

-- วันที่ 22 มิถุนายน 2025
(1, '2025-06-22', 0),  -- กิตติพงษ์ ไม่มา
(2, '2025-06-22', 1),  -- นฤมล มา
(3, '2025-06-22', 1),  -- ศิริพร มา
(4, '2025-06-22', 0),  -- ธนกร ไม่มา
(5, '2025-06-22', 1),  -- อรทัย มา
(6, '2025-06-22', 1),  -- พิชญ์นรี มา
(7, '2025-06-22', 1),  -- นันทวัฒน์ มา
(8, '2025-06-22', 1),  -- ปิยะดา มา

-- วันที่ 23 มิถุนายน 2025
(1, '2025-06-23', 1),  -- กิตติพงษ์ มา
(2, '2025-06-23', 1),  -- นฤมล มา
(3, '2025-06-23', 1),  -- ศิริพร มา
(4, '2025-06-23', 1),  -- ธนกร มา
(5, '2025-06-23', 0),  -- อรทัย ไม่มา
(6, '2025-06-23', 1),  -- พิชญ์นรี มา
(7, '2025-06-23', 1),  -- นันทวัฒน์ มา
(8, '2025-06-23', 1),  -- ปิยะดา มา

-- วันที่ 24 มิถุนายน 2025
(1, '2025-06-24', 1),  -- กิตติพงษ์ มา
(2, '2025-06-24', 1),  -- นฤมล มา
(3, '2025-06-24', 0),  -- ศิริพร ไม่มา
(4, '2025-06-24', 1),  -- ธนกร มา
(5, '2025-06-24', 1),  -- อรทัย มา
(6, '2025-06-24', 1),  -- พิชญ์นรี มา
(7, '2025-06-24', 1),  -- นันทวัฒน์ มา
(8, '2025-06-24', 0);  -- ปิยะดา ไม่มา

-- เพิ่มข้อมูลเก่าสำหรับสถิติรายเดือน (พฤษภาคม 2025)
INSERT INTO attendance (student_id, date, status) VALUES
-- สัปดาห์ที่ 1 พฤษภาคม
(1, '2025-05-01', 1), (2, '2025-05-01', 1), (3, '2025-05-01', 0), (4, '2025-05-01', 1),
(5, '2025-05-01', 1), (6, '2025-05-01', 1), (7, '2025-05-01', 1), (8, '2025-05-01', 0),
(1, '2025-05-02', 0), (2, '2025-05-02', 1), (3, '2025-05-02', 1), (4, '2025-05-02', 1),
(5, '2025-05-02', 1), (6, '2025-05-02', 0), (7, '2025-05-02', 1), (8, '2025-05-02', 1),
(1, '2025-05-03', 1), (2, '2025-05-03', 1), (3, '2025-05-03', 1), (4, '2025-05-03', 1),
(5, '2025-05-03', 0), (6, '2025-05-03', 1), (7, '2025-05-03', 1), (8, '2025-05-03', 1),

-- สัปดาห์ที่ 2 พฤษภาคม
(1, '2025-05-06', 1), (2, '2025-05-06', 0), (3, '2025-05-06', 1), (4, '2025-05-06', 1),
(5, '2025-05-06', 1), (6, '2025-05-06', 1), (7, '2025-05-06', 0), (8, '2025-05-06', 1),
(1, '2025-05-07', 1), (2, '2025-05-07', 1), (3, '2025-05-07', 1), (4, '2025-05-07', 0),
(5, '2025-05-07', 1), (6, '2025-05-07', 1), (7, '2025-05-07', 1), (8, '2025-05-07', 1),
(1, '2025-05-08', 0), (2, '2025-05-08', 1), (3, '2025-05-08', 1), (4, '2025-05-08', 1),
(5, '2025-05-08', 1), (6, '2025-05-08', 1), (7, '2025-05-08', 1), (8, '2025-05-08', 0),

-- สัปดาห์ที่ 3 พฤษภาคม
(1, '2025-05-13', 1), (2, '2025-05-13', 1), (3, '2025-05-13', 0), (4, '2025-05-13', 1),
(5, '2025-05-13', 1), (6, '2025-05-13', 1), (7, '2025-05-13', 1), (8, '2025-05-13', 1),
(1, '2025-05-14', 1), (2, '2025-05-14', 1), (3, '2025-05-14', 1), (4, '2025-05-14', 1),
(5, '2025-05-14', 0), (6, '2025-05-14', 1), (7, '2025-05-14', 0), (8, '2025-05-14', 1),
(1, '2025-05-15', 0), (2, '2025-05-15', 1), (3, '2025-05-15', 1), (4, '2025-05-15', 1),
(5, '2025-05-15', 1), (6, '2025-05-15', 1), (7, '2025-05-15', 1), (8, '2025-05-15', 1),

-- สัปดาห์ที่ 4 พฤษภาคม
(1, '2025-05-20', 1), (2, '2025-05-20', 0), (3, '2025-05-20', 1), (4, '2025-05-20', 1),
(5, '2025-05-20', 1), (6, '2025-05-20', 1), (7, '2025-05-20', 1), (8, '2025-05-20', 0),
(1, '2025-05-21', 1), (2, '2025-05-21', 1), (3, '2025-05-21', 1), (4, '2025-05-21', 0),
(5, '2025-05-21', 1), (6, '2025-05-21', 1), (7, '2025-05-21', 1), (8, '2025-05-21', 1),
(1, '2025-05-22', 1), (2, '2025-05-22', 1), (3, '2025-05-22', 0), (4, '2025-05-22', 1),
(5, '2025-05-22', 1), (6, '2025-05-22', 0), (7, '2025-05-22', 1), (8, '2025-05-22', 1);

-- Query สำหรับตรวจสอบข้อมูลที่ INSERT แล้ว
SELECT 
    DATE(a.date) as วันที่,
    COUNT(CASE WHEN a.status = 1 THEN 1 END) as จำนวนที่มา,
    COUNT(CASE WHEN a.status = 0 THEN 1 END) as จำนวนที่ไม่มา,
    COUNT(*) as รวมทั้งหมด,
    ROUND((COUNT(CASE WHEN a.status = 1 THEN 1 END) / COUNT(*)) * 100, 1) as เปอร์เซ็นต์ที่มา
FROM attendance a
WHERE a.date >= '2025-06-17' AND a.date <= '2025-06-24'
GROUP BY DATE(a.date)
ORDER BY DATE(a.date);

-- Query สำหรับดูสถิติรายนักเรียน
SELECT 
    s.student_name as ชื่อ,
    s.student_nickname as ชื่อเล่น,
    COUNT(CASE WHEN a.status = 1 THEN 1 END) as วันที่มา,
    COUNT(CASE WHEN a.status = 0 THEN 1 END) as วันที่ไม่มา,
    ROUND((COUNT(CASE WHEN a.status = 1 THEN 1 END) / COUNT(*)) * 100, 1) as เปอร์เซ็นต์การมา
FROM students s
JOIN attendance a ON s.id = a.student_id
WHERE a.date >= '2025-06-17' AND a.date <= '2025-06-24'
GROUP BY s.id, s.student_name, s.student_nickname
ORDER BY เปอร์เซ็นต์การมา DESC;